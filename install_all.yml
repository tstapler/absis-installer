# vim:ft=ansible:
---
- name: Install dependencies
  hosts: localhost
  tasks:
    - include: tasks/main.yml
    - include_vars: defaults/main.yml

- name: Install Rancher
  hosts: localhost
  become: yes
  roles:
    - { role: rancher, tags: ["rancher"] }

- name: Install Rancher client
  hosts: localhost
  become: yes
  roles:
    - { role: rancher_reg, tags: ["rancher_reg"]}

# Add and configure LDAP

- name: Deploy Plex Container
  hosts: localhost
  become: yes
  roles:
    - { role: plex, tags: ["plex"] }

# - name: Deploy OpenLDAP Containers
#   hosts: localhost
#   become: yes
#   roles:
#     - { role: openldap, tags: ["openldap"] }

- name: Deploy Pydio Container
  hosts: localhost
  become: yes
  roles:
    - { role: pydio, tags: ["pydio"] }

- name: Setup Nginx
  hosts: localhost
  roles:
    - role: nginx
      nginx_http_params:
      nginx_sites:
        rancher:
          - listen 80
          - server_name rancher
          - root /rancher
          - location / { proxy_pass http://127.0.0.1:8080 }
      nginx_configs:
